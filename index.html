<!doctype html>
<html>
  <head>
    <title>Kitchen Sink</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://sf.gov/sites/default/files/css/css_agj0hHq_5HVrrndLMoscH8SQhKRwitxKeDC_Y2RXMOc.css?q8589x">
  </head>
  <body>
    <div class="page-node-type-form-page">
      <div class="form-page">
        <div class="container p-3 formio-sfds">
          <h1>Kitchen sink</h1>

          <template id="form-template">
            <section class="example">
              <h2 class="h3" data-placeholder="title"></h2>
              <form></form>
            </section>
          </template>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/formiojs@latest/dist/formio.full.js"></script>
    <script src="dist/formio-sfds.standalone.js"></script>
    <script defer>
      const defaults = {
        display: 'form'
      }

      fetch('./examples.json')
        .then(res => res.json())
        .then(examples => {
          const template = document.getElementById('form-template')
          const root = template.parentNode
          const forms = []

          for (const example of examples) {
            const node = template.content.cloneNode(true).firstElementChild
            root.appendChild(node)
            const form = createForm(example, node)
            forms.push(form)
          }

          Promise.all(forms).then(() => {
            const { hash } = window.location
            if (hash) {
              const target = document.querySelector(hash)
              if (target && target.scrollIntoView) {
                target.scrollIntoView({ behavior: 'smooth' })
              } else if (target) {
                window.location = hash
              }
            }
          })
        })

      function createForm (example, node) {
        const { id, title } = example
        node.id = id
        node.querySelector('[data-placeholder=title]').innerHTML = `<a href="#${id}" class="fg-grey-4 no-u">#</a> ${title || id}`

        console.warn('Mounting example:', example, 'to', node)

        Formio.createForm(node.querySelector('form'), Object.assign({}, defaults, example))
      }
    </script>
  </body>
</html>
